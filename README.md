# Wound Band-Aid Overlay (Deepskin-based)

This script detects a wound region from a segmentation mask generated by:

- https://github.com/Nico-Curti/Deepskin

Then it overlays a rotated/scaled band-aid on the wound and shows original vs modified image.

## Requirements

- Python 3.9+
- `opencv-python`, `numpy`, `matplotlib`
- Local clone of `Nico-Curti/Deepskin`

```bash
pip install opencv-python numpy matplotlib
```

## Usage

```bash
python wound_bandaid.py \
  --input arm.jpg \
  --seg-repo /path/to/Deepskin
```

Batch run:

```bash
python wound_bandaid.py \
  --input-dir wound_images \
  --seg-repo /path/to/Deepskin
```

### Important

- `--seg-command` must contain `{input}` (absolute input image path).
- `{python}` is optional and points to the current interpreter (recommended for virtualenvs).
- `{mask}` is optional. If omitted, the script looks for `<input>_deepskin_mask.png` next to the input file (Deepskin CLI default).
- Use `--mask-out mask.png` if you want to keep the generated mask.
- Use `--fallback-heuristic` to fall back to redness detection if model inference fails.
- Use `--bandaid my_bandaid.png` to provide custom RGBA overlay.
- Use `--blend seamless` (default) for Poisson blending, or `--blend alpha` for classic alpha compositing.
- Use `--overlay-out overlay.png` to save the transformed overlay (RGBA on transparent canvas). Defaults to `<input>_overlay.png`.
- Output defaults to `<input>_with_bandaid.jpg`.
- For batch runs, outputs are written to `wound_images/output`, overlays to `wound_images/overlays`, masks to `wound_images/masks`, and pose debug to `wound_images/pose_debug` (override with `--output-dir`, `--overlay-dir`, `--mask-dir`, `--pose-debug-dir`).
- Use `--size-scale` to control band-aid size relative to wound size.
- Use `--wrap-strength` to warp/curve the band-aid in both directions.
- Use `--stretch-to-wound` to stretch the band-aid to match wound width/height (non-uniform scaling).
- Use `--blend deep` to run DeepImageBlending (requires the repo and its dependencies).
- DeepImageBlending options: `--deep-blend-repo`, `--deep-blend-size`, `--deep-blend-steps`, `--deep-blend-gpu-id`.
- DeepImageBlending tuning: `--deep-blend-pass first|second` and weights (`--deep-blend-style-weight`, `--deep-blend-content-weight`, `--deep-blend-grad-weight`, `--deep-blend-tv-weight`, plus `*-2` for second pass).
- When using Deepskin semantic masks (RGB), the red channel is used for the wound ROI.
- Use `--use-mediapipe` to refine rotation using MediaPipe Pose (optional).
- Tune pose blending with `--pose-weight` (0=mask only, 1=pose only).
- If your MediaPipe install uses the Tasks API (no `mp.solutions`), pass `--pose-model-path` pointing to the Pose task model file, or let it auto-download (default).
- Use `--pose-model-url` to override the model download URL.
- Use `--no-pose-model-download` to disable auto-download.
- Default auto-download uses the MediaPipe Pose Landmarker heavy model.
- Use `--pose-debug-out pose_debug.jpg` to save a pose visualization with landmarks and the chosen orientation vector.
- Defaults to `<input>_pose_debug.jpg` for single-image runs.

## Output

- Saves modified image to `--output`
- Displays side-by-side view unless `--no-show` is provided
